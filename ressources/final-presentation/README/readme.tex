\documentclass[12pt]{article}

% Language setting
% Replace `english' with e.g. `pathspanish' to change the document language
\usepackage[english]{babel}

% Set page size and margins
% Replace `letterpaper' with`a4paper' for UK/EU standard size
\usepackage[a4paper,top=2cm,bottom=2cm,left=3cm,right=3cm,marginparwidth=1.75cm]{geometry}

% Useful packages
\usepackage{amsmath}
\usepackage{graphicx}
\usepackage{subfig}

\usepackage{xcolor}
\usepackage{listings}
\usepackage{caption}
\DeclareCaptionFont{white}{\color{white}}
\DeclareCaptionFormat{listing}{%
  \parbox{\textwidth}{\colorbox{gray}{\parbox{\textwidth}{#1#2#3}}\vskip-4pt}}
\captionsetup[lstlisting]{format=listing,labelfont=white,textfont=white}
\lstset{frame=lrb,xleftmargin=\fboxsep,xrightmargin=-\fboxsep}

\usepackage[colorlinks=true, allcolors=black]{hyperref}

\begin{document}

%title
\title{\underline{README}}
\date{June 2022}


\author{%
    Group: Autonomobile 
    }

\maketitle

\centerline{\includegraphics[height=10cm]{../../logos/logo-transparent-black.png}}
\newpage

\tableofcontents
\newpage
\section{How to setup the software}

It is recommended to have python 3.6.X installed, as this is the python version installed on the car.
To avoid any packages conflicts with your existing python installation, we will use virtualenv install virtualenv using:\\

\noindent\fbox{%
    \parbox{\textwidth}{%
        pip install virtualenv
    }%
}\\

Clone the repo, and install the package and it's dependencies:\\

\noindent\fbox{%
    \parbox{\textwidth}{%
        git clone https://github.com/Autonomobile/AutoPylot.git\\
cd AutoPylot
    }%
}\\

Then, create a virtual env (you need to specify the path to your python3.6):\\

\noindent\fbox{%
    \parbox{\textwidth}{%
        virtualenv --python your path to python.exe venv
    }%
}\\

Then, every time you will be working on the project, you will need to activate this environment, to do so:\\

\noindent\fbox{%
    \parbox{\textwidth}{%
       \path{\venv\Scripts\activate}.
    }%
}\\

Now, to install autopylot and its requirements (including dev requirements):\\

\noindent\fbox{%
    \parbox{\textwidth}{%
        pip install -e .[dev]
    }%
}\\

For the code formatting, we will use something called "pre-commit", that enables us to automate stuff as linting before committing. If the code is not well linted, it will throw an error before committing and will lint it, you will only have to commit again to apply the changes the linter did ! Here is how to setup pre-commit:\\


\noindent\fbox{%
    \parbox{\textwidth}{%
        pip install -e .[dev]
    }%
}\\

You are now all setup to work on the project ! Don't forget to keep the setup.py and requirements.txt up to date.\\

To exit the virtualenv:\\

\noindent\fbox{%
    \parbox{\textwidth}{%
       deactivate
    }%
}\\

Useful tools:
\\\\
Setup a python linter (we use flake8) : https://code.visualstudio.com/docs/python/linting
setup the test extension of VS-Code : https://code.visualstudio.com/docs/python/testing
use a docstring generator for example the VS-Code extension "Python Docstring Generator"


\section{How to setup the Telemetry Server}
Make sure to have NodeJS and NPM installed.\\
Open thetelemetry folder in another VS-Code window\\

Installation:\\

\noindent\fbox{%
    \parbox{\textwidth}{%
       npm i
    }%
}\\

Start dev build:\\

\noindent\fbox{%
    \parbox{\textwidth}{%
       npm run build\\
       npm run start
    }%
}\\

\section{How to collect, train and deploy your model}
Here is the three main steps in the making of a model\\

\subsection{Collect}
First you need to collect some data.\\

You will need to select in the "settings.json" the "CAMERA_TYPE", "ACTUATOR_TYPE" and "CONTROLLER_TYPE". By default they are set for the car configuration eg "webcam", "serial" and "xbox" respectively, if you are collecting data on a PC, I suggest you using "sim", "sim" and "keyboard". This will use data coming from the simulator, inputs from the keyboard and output them (actuate) in the simulator.


Start the script with the following command (don't need to cd if you are in the right directory):\\

\noindent\fbox{%
    \parbox{\textwidth}{%
    cd main_programs/examples \\
    python3 drive_with_controller.py
    }%
}\\

To drive depending on the controller type you use:\\

"xbox": steering: left joystick, throttle: left and right triggers\\
"keyboard": steering: "q" and "d" keys, throttle: "z" and "s" keys.\\


To record data depending on the controller type you use:\\

"xbox": hold button "a"\\
"keyboard": hold key "r"\\
You should see the collected data your "~/collect" folder. If unsure about the location of the folder, check the "COLLECT_PATH" settings in the settings.json\\

Note: by default a model will be loaded, if you don't touch anything, you will enter "autonomous" mode using the predictions from this default model.\\


\subsection{Training}
there are plenty settings for the training script:\\
"MODEL_TYPE": you need to set the type of the model you want to build. For example, if you made a new method to create a model in architectures.py in the Models class called "steering_model". You can set the "model_type" field to steering_model and when training your model, it will be created using this function.\\
"MODEL_NAME": the name of the model you want to train, the model will be saved under this name. If you wish to retrain it later, make sure to use the same name (if you wish you can copy a model, change its name and then train it again to avoid loosing the previously trained one).\\
"TRAIN_LOAD_MODEL": whether you want to load the model or create one from scratch.\\
"TRAIN_BATCH_SIZE": How much data you want in one batch.\\
"TRAIN_EPOCHS": How many times you want to train the model on the dataset before saving it.\\
"TRAIN_SPLITS": Proportion of data in the training set and testing set. If set to 0.9, this will result in having 90% of the data going to the training set and 10% going to the testing set.\\
"TRAIN_AUGM_FREQ": How frequent we want data to be augmented using data augmentation functions.\\


you can now start this training script with:\\
\noindent\fbox{%
    \parbox{\textwidth}{%
    cd main_programs/\\
    python3 train.py
    }%
}\\

Once finished, your new model should be saved in the "models" folder at the root of your project.\\

\subsection{Deploy}
You will need to change in the settings.json the "MODEL_NAME" field to the name of the model you just trained. then same as for the "collect" part, start the drive_with_controller.py script and enjoy! \\

\noindent\fbox{%
    \parbox{\textwidth}{%
    cd main_programs/examples
    python3 drive_with_controller.py
    }%
}\\

\end{document}
